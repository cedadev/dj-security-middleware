# DJ Security Middleware

Adds a layer to interact with a paste enabled, Django based, security service
typically a dj_security app.

## Usage

The middleware checks two cases:

1. If the HTTP request contains a cookie named after the ACCOUNT_COOKIE_NAME
parameter.

2. The underlying application defines a function returning a not None value
(see DJ_SECURITY_AUTH_CHECK).

If none of the previous is verified the middleware redirect the request to 
the DJ_SECURITY_LOGIN_SERVICE for authentication. If this succeeds, the login
service should set the appropriate cookie to be caught by the middleware.

If a valid cookie is found, the middleware will read the content of the cookie
and assign it to 'authenticated_user' in the request.

### Logout

If the request, GET or POST, contains a parameter 'logout' with value different
from '' then the user's cookies, if found, will be removed from the next
response.

## Settings

The middleware requires following Django settings:

- SECURITY_LOGIN_SERVICE specifies where the URL where authentication service
is listening (say http://example.com/login).

- ACCOUNT_COOKIE_NAME the name of the cookie generated by the authentication
service.

- COOKIE_DOMAIN (defaults to the host of SECURITY_LOGIN_SERVICE) the domain
of the account cookie generated by the authentication service.

- SECURITY_SHAREDSECRET specifies the secret key used by the authentication
service to encrypt the account cookie. This is expected to be base64 encoded.

- REDIRECT_FIELD_NAME (default = 'r') specifies the name of the GET parameter 
containing return address to be used by the authentication layer if login is
successful.

The following optional settings are also available:

- OPENID_COOKIE_NAME the name of an openid cookie generated by the
authentication service.

- EXTRA_COOKIE_NAMES the name of any additional cookies generated by the
authentication service which should be removed by the middleware on logout.

- DJ_SECURITY_FILTER is a list of regular expressions used to filter which
URLs the middleware SHOULD NOT protect.

- DJ_SECURITY_AUTH_CHECK is a function which accepts a request object and
can return True in order to force the middleware to skip the authentication
check for the request. If the function returns False, or raises an exception,
The middleware will proceed with the authentication check as normal.

  This functions may be usefull even in two further situations:
    - enable/disable the middleware (an almost empty function which simply
      returns True/False)
    - append to the HTTPRequest further, application related, parameters

  Example:

  ```python
  def my_auth(request):
      return True
  
  DJ_SECURITY_AUTH_CHECK = my_auth
  ```
